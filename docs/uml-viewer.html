<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagramas UML - Sistema de Generaci√≥n de Valores Nietzscheano</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        nav {
            background: #f7fafc;
            padding: 20px;
            border-bottom: 2px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        nav a {
            color: #4a5568;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            background: white;
            border: 2px solid #cbd5e0;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        nav a:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        main {
            padding: 40px;
        }

        section {
            margin-bottom: 60px;
            scroll-margin-top: 100px;
        }

        section h2 {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        section p {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.05rem;
        }

        .diagram-container {
            background: #f7fafc;
            padding: 30px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #e2e8f0;
            overflow-x: auto;
        }

        .mermaid {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .error-message {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        footer {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
        }

        footer p {
            margin: 5px 0;
            opacity: 0.9;
        }

        footer a {
            color: #90cdf4;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .note {
            background: #fff5e6;
            border-left: 4px solid #ffa500;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .note strong {
            color: #d97706;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            nav ul {
                flex-direction: column;
            }

            nav a {
                text-align: center;
            }

            main {
                padding: 20px;
            }

            section h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Diagramas UML del Sistema</h1>
            <p>Sistema de Generaci√≥n de Valores Nietzscheano</p>
            <p style="font-size: 0.9rem; margin-top: 10px;">Versi√≥n 1.0 | √öltima actualizaci√≥n: 2026-01-11</p>
        </header>

        <nav>
            <ul>
                <li><a href="#intro">Introducci√≥n</a></li>
                <li><a href="#clases">Diagrama de Clases</a></li>
                <li><a href="#componentes">Diagrama de Componentes</a></li>
                <li><a href="#secuencia">Diagrama de Secuencia</a></li>
                <li><a href="#estados">Diagrama de Estados</a></li>
                <li><a href="#despliegue">Diagrama de Despliegue</a></li>
            </ul>
        </nav>

        <main>
            <section id="intro">
                <h2>üìñ Introducci√≥n</h2>
                <p>Los diagramas UML son esenciales para visualizar y comunicar la arquitectura del sistema antes de la implementaci√≥n. Este documento incluye todos los diagramas UML necesarios para entender la estructura, relaciones, flujos y despliegue del sistema.</p>

                <div class="note">
                    <strong>Nota:</strong> Este documento contiene los diagramas UML completos del Sistema de Generaci√≥n de Valores Nietzscheano, incluyendo diagramas de clases, componentes, secuencia, estados y despliegue.
                </div>

                <p><strong>Diagramas incluidos:</strong></p>
                <ol style="margin-left: 20px; color: #4a5568;">
                    <li>Diagrama de Clases - Estructura de clases y relaciones</li>
                    <li>Diagrama de Componentes - Componentes principales e interfaces</li>
                    <li>Diagrama de Secuencia - Flujos de interacci√≥n</li>
                    <li>Diagrama de Estados - M√°quina de estados finitos (FSM)</li>
                    <li>Diagrama de Despliegue - Arquitectura de despliegue</li>
                </ol>
            </section>

            <section id="clases">
                <h2>üèóÔ∏è 1. Diagrama de Clases</h2>
                <p>El diagrama de clases muestra la estructura est√°tica del sistema, incluyendo clases principales, m√≥dulos, agentes, interfaces y sus relaciones.</p>

                <div class="diagram-container">
                    <pre class="mermaid">
classDiagram
    %% Core Classes
    class Orchestrator {
        -valueEngine: ValueEngine
        -dialecticalSystem: DialecticalSystem
        -ragSystem: RAGSystem
        -nihilismMonitor: NihilismMonitor
        +generateValue(concept: string) Promise
        +coordinatePhase(phase: Phase) Promise
        +handleError(error: Error) void
    }

    class ValueEngine {
        -currentState: ValueState
        -stateHistory: ValueState[]
        +transitionTo(state: ValueState) Result
        +validateTransition(from: ValueState, to: ValueState) boolean
        +getCurrentState() ValueState
        +reset() void
    }

    class DialecticalSystem {
        -agents: Map
        -debateHistory: Debate[]
        +initiateDebate(participants: AgentType[], topic: string) Promise
        +synthesizePerspectives(perspectives: Perspective[]) Synthesis
        +addAgent(agent: Agent) void
    }

    class NihilismMonitor {
        -metrics: NihilismMetrics
        -observers: Observer[]
        +observePhase(phase: Phase) void
        +classifyNihilism(state: NihilisticState) NihilismType
        +generateAlert(alert: Alert) void
        +getMetrics() NihilismMetrics
    }

    %% Phase Modules
    class DeconstructionModule {
        -genealogist: Genealogist
        -ragSystem: RAGSystem
        +deconstruct(concept: MoralConcept) Promise
        +analyzeGenealogy(concept: MoralConcept) Genealogy
    }

    class NihilisticModule {
        -dionysus: Dionysus
        -lastMan: LastMan
        +createVoid(concept: MoralConcept) Promise
        +destroyValues(values: Value[]) void
    }

    class CreativeModule {
        -zarathustra: Zarathustra
        -dionysus: Dionysus
        -apollo: Apollo
        +createValue(concept: MoralConcept, void: NihilisticState) Promise
        +synthesizePerspectives(perspectives: Perspective[]) Value
    }

    class EvaluationModule {
        -zarathustra: Zarathustra
        -apollo: Apollo
        -lastMan: LastMan
        +evaluateValue(value: Value) Promise
        +applyEternalReturn(value: Value) boolean
        +checkStructure(value: Value) StructureCheck
    }

    %% Agents
    class Agent {
        &lt;&lt;interface&gt;&gt;
        +generatePerspective(topic: string, context: Context) Promise
        +getName() string
        +getPersonality() Personality
    }

    class Zarathustra {
        +generatePerspective(topic: string, context: Context) Promise
        +affirmLife(value: Value) boolean
        +applyEternalReturn(value: Value) boolean
    }

    class Genealogist {
        +generatePerspective(topic: string, context: Context) Promise
        +deconstructGenealogy(concept: MoralConcept) Genealogy
        +revealOrigins(value: Value) Origin[]
    }

    class Dionysus {
        +generatePerspective(topic: string, context: Context) Promise
        +createFromVoid(void: NihilisticState) Value
        +destroyValues(values: Value[]) void
    }

    class Apollo {
        +generatePerspective(topic: string, context: Context) Promise
        +giveForm(value: Value) StructuredValue
        +evaluateStructure(value: Value) StructureCheck
    }

    class LastMan {
        +generatePerspective(topic: string, context: Context) Promise
        +detectWeakness(value: Value) boolean
        +warnPassiveNihilism(state: NihilisticState) Alert
    }

    %% RAG System
    class RAGSystem {
        -vectorStore: VectorStore
        -embedder: Embedder
        -documentProcessor: DocumentProcessor
        +retrieveContext(query: string, limit: number) Promise
        +processCorpus(corpus: Document[]) Promise
        +searchSemantic(query: string) Promise
    }

    class DocumentProcessor {
        +chunkDocuments(documents: Document[]) Chunk[]
        +extractMetadata(document: Document) Metadata
    }

    class Embedder {
        +generateEmbedding(text: string) Promise
        +generateBatchEmbeddings(texts: string[]) Promise
    }

    class VectorStore {
        +storeEmbedding(embedding: Embedding) Promise
        +searchSimilar(query: Vector, limit: number) Promise
    }

    %% LLM Integration
    class LLMClient {
        &lt;&lt;interface&gt;&gt;
        +generate(prompt: Prompt) Promise
        +stream(prompt: Prompt) AsyncGenerator
    }

    class LMStudioClient {
        +generate(prompt: Prompt) Promise
        +stream(prompt: Prompt) AsyncGenerator
        -baseUrl: string
        -apiKey: string
    }

    %% Repositories
    class ValueRepository {
        +save(value: Value) Promise
        +findById(id: string) Promise
        +findByCriteria(criteria: Criteria) Promise
    }

    class GenealogyRepository {
        +save(genealogy: Genealogy) Promise
        +findByValueId(valueId: string) Promise
    }

    %% Types
    class Value {
        +id: string
        +content: string
        +phase: Phase
        +createdAt: Date
        +genealogy: Genealogy
    }

    class MoralConcept {
        +name: string
        +description: string
        +origin: string
    }

    class Perspective {
        +agent: AgentType
        +content: string
        +tone: Tone
    }

    class DebateResult {
        +perspectives: Perspective[]
        +synthesis: Synthesis
        +conflicts: Conflict[]
    }

    %% Relationships
    Orchestrator --> ValueEngine : uses
    Orchestrator --> DialecticalSystem : coordinates
    Orchestrator --> RAGSystem : requests context
    Orchestrator --> NihilismMonitor : receives alerts
    Orchestrator --> DeconstructionModule : orchestrates
    Orchestrator --> NihilisticModule : orchestrates
    Orchestrator --> CreativeModule : orchestrates
    Orchestrator --> EvaluationModule : orchestrates

    DialecticalSystem --> Agent : coordinates
    DialecticalSystem --> Zarathustra : uses
    DialecticalSystem --> Genealogist : uses
    DialecticalSystem --> Dionysus : uses
    DialecticalSystem --> Apollo : uses
    DialecticalSystem --> LastMan : uses

    Agent <|.. Zarathustra : implements
    Agent <|.. Genealogist : implements
    Agent <|.. Dionysus : implements
    Agent <|.. Apollo : implements
    Agent <|.. LastMan : implements

    DeconstructionModule --> Genealogist : uses
    NihilisticModule --> Dionysus : uses
    NihilisticModule --> LastMan : uses
    CreativeModule --> Zarathustra : uses
    CreativeModule --> Dionysus : uses
    CreativeModule --> Apollo : uses
    EvaluationModule --> Zarathustra : uses
    EvaluationModule --> Apollo : uses
    EvaluationModule --> LastMan : uses

    RAGSystem --> VectorStore : uses
    RAGSystem --> Embedder : uses
    RAGSystem --> DocumentProcessor : uses
    RAGSystem --> LLMClient : uses

    LLMClient <|.. LMStudioClient : implements

    ValueRepository --> Value : manages
    GenealogyRepository --> Genealogy : manages

    NihilismMonitor --> ValueEngine : observes
                    </pre>
                </div>
            </section>

            <section id="componentes">
                <h2>üß© 2. Diagrama de Componentes</h2>
                <p>El diagrama de componentes muestra los componentes principales del sistema, sus interfaces y dependencias externas.</p>

                <div class="diagram-container">
                    <pre class="mermaid">
graph TB
    subgraph API_Layer["API Layer"]
        APIREST[API REST - Fastify]
    end

    subgraph Application_Layer["Application Layer"]
        Orchestrator[Orchestrator]
        ValueEngine[ValueEngine FSM]
        DialecticalSystem[DialecticalSystem]
    end

    subgraph Domain_Modules["Domain Modules"]
        DeconstructionModule[DeconstructionModule]
        NihilisticModule[NihilisticModule]
        CreativeModule[CreativeModule]
        EvaluationModule[EvaluationModule]
    end

    subgraph Agents_Layer["Agents Layer"]
        Zarathustra[Zarathustra]
        Genealogist[Genealogist]
        Dionysus[Dionysus]
        Apollo[Apollo]
        LastMan[LastMan]
    end

    subgraph RAG_System["RAG System"]
        RAGSystem[RAGSystem]
        DocumentProcessor[DocumentProcessor]
        Embedder[Embedder - Transformers.js]
        VectorStore[VectorStore - pgvector]
    end

    subgraph Monitoring_System["Monitoring"]
        NihilismMonitor[NihilismMonitor]
        MetricsExporter[Metrics Exporter - Prometheus]
    end

    subgraph Queue_System["Queue System"]
        QueueManager[Queue Manager - BullMQ]
        ValueWorker[Value Generation Worker]
    end

    subgraph LLM_Integration["LLM Integration"]
        LLMClient[LLM Client - OpenAI SDK]
        LMStudio[LM Studio - Local]
    end

    subgraph Data_Layer["Data Layer"]
        PostgreSQL[(PostgreSQL + pgvector)]
        Neo4j[(Neo4j Graph DB)]
        Redis[(Redis Cache + Queues)]
    end

    subgraph External_Services["External Services"]
        Prometheus[Prometheus Metrics]
        Grafana[Grafana Visualization]
    end

    APIREST --> Orchestrator
    APIREST --> QueueManager

    Orchestrator --> ValueEngine
    Orchestrator --> DialecticalSystem
    Orchestrator --> DeconstructionModule
    Orchestrator --> NihilisticModule
    Orchestrator --> CreativeModule
    Orchestrator --> EvaluationModule
    Orchestrator --> RAGSystem
    Orchestrator --> NihilismMonitor

    DeconstructionModule --> Genealogist
    NihilisticModule --> Dionysus
    NihilisticModule --> LastMan
    CreativeModule --> Zarathustra
    CreativeModule --> Dionysus
    CreativeModule --> Apollo
    EvaluationModule --> Zarathustra
    EvaluationModule --> Apollo
    EvaluationModule --> LastMan

    DialecticalSystem --> Zarathustra
    DialecticalSystem --> Genealogist
    DialecticalSystem --> Dionysus
    DialecticalSystem --> Apollo
    DialecticalSystem --> LastMan

    RAGSystem --> DocumentProcessor
    RAGSystem --> Embedder
    RAGSystem --> VectorStore
    RAGSystem --> LLMClient

    LLMClient --> LMStudio

    VectorStore --> PostgreSQL
    Orchestrator --> PostgreSQL
    Orchestrator --> Neo4j
    QueueManager --> Redis

    NihilismMonitor --> MetricsExporter
    MetricsExporter --> Prometheus
    Prometheus --> Grafana

    QueueManager --> ValueWorker
    ValueWorker --> Orchestrator
                    </pre>
                </div>
            </section>

            <section id="secuencia">
                <h2>üîÑ 3. Diagrama de Secuencia</h2>
                <p>El diagrama de secuencia muestra el flujo completo de generaci√≥n de valores a trav√©s de las 4 fases, incluyendo interacciones entre componentes.</p>

                <div class="diagram-container">
                    <pre class="mermaid">
sequenceDiagram
    participant User as Usuario Final
    participant API as API REST
    participant Queue as Queue Manager
    participant Worker as Value Worker
    participant Orch as Orchestrator
    participant VE as ValueEngine
    participant DS as DialecticalSystem
    participant RAG as RAG System
    participant NM as NihilismMonitor
    participant Gen as Genealogist
    participant Dion as Dionysus
    participant Zar as Zarathustra
    participant Apo as Apollo
    participant Last as LastMan

    User->>API: POST /api/values/generate
    API->>Queue: Enqueue generation job
    API-->>User: 202 Accepted (jobId)

    Queue->>Worker: Process job
    Worker->>Orch: generateValue(concept)

    Orch->>VE: transitionTo(DECONSTRUCTION)
    VE-->>Orch: State updated

    Orch->>RAG: retrieveContext(concept)
    RAG-->>Orch: Context from Nietzsche

    Orch->>DS: initiateDebate
    DS->>Gen: generatePerspective
    Gen->>RAG: retrieveContext(genealogy)
    RAG-->>Gen: Genealogical context
    Gen-->>DS: Perspective (deconstruction)
    DS-->>Orch: DebateResult

    Orch->>NM: observePhase(DECONSTRUCTION)
    NM-->>Orch: Metrics recorded

    Orch->>VE: transitionTo(NIHILISTIC)
    VE-->>Orch: State updated

    Orch->>DS: initiateDebate
    DS->>Dion: generatePerspective
    Dion-->>DS: Perspective
    DS->>Last: generatePerspective
    Last-->>DS: Perspective
    DS-->>Orch: DebateResult

    Orch->>NM: observePhase(NIHILISTIC)
    NM->>NM: classifyNihilism
    NM-->>Orch: Metrics + Alerts

    Orch->>VE: transitionTo(CREATIVE)
    VE-->>Orch: State updated

    Orch->>DS: initiateDebate
    DS->>Zar: generatePerspective
    Zar-->>DS: Perspective
    DS->>Dion: generatePerspective
    Dion-->>DS: Perspective
    DS->>Apo: generatePerspective
    Apo-->>DS: Perspective
    DS->>DS: synthesizePerspectives
    DS-->>Orch: DebateResult

    Orch->>VE: transitionTo(EVALUATION)
    VE-->>Orch: State updated

    Orch->>DS: initiateDebate
    DS->>Zar: generatePerspective
    Zar-->>DS: Perspective
    DS->>Apo: generatePerspective
    Apo-->>DS: Perspective
    DS->>Last: generatePerspective
    Last-->>DS: Perspective
    DS-->>Orch: DebateResult

    Orch->>Orch: Finalize value
    Orch-->>Worker: Value generated
    Worker-->>Queue: Job completed
    Queue->>API: Notify completion
    API-->>User: GET /api/values/{id}
                    </pre>
                </div>
            </section>

            <section id="estados">
                <h2>üîÄ 4. Diagrama de Estados (FSM)</h2>
                <p>El diagrama de estados muestra la m√°quina de estados finitos del ValueEngine, con todas las transiciones entre fases.</p>

                <div class="diagram-container">
                    <pre class="mermaid">
stateDiagram-v2
    [*] --> IDLE: System initialized

    IDLE --> DECONSTRUCTION: generateValue(concept)

    DECONSTRUCTION --> NIHILISTIC: deconstructionComplete()
    DECONSTRUCTION --> ERROR: deconstructionFailed()

    NIHILISTIC --> CREATIVE: voidCreated()
    NIHILISTIC --> ERROR: voidCreationFailed()
    NIHILISTIC --> DECONSTRUCTION: retryDeconstruction()

    CREATIVE --> EVALUATION: valueCreated()
    CREATIVE --> ERROR: valueCreationFailed()
    CREATIVE --> NIHILISTIC: retryVoid()

    EVALUATION --> COMPLETED: evaluationPassed()
    EVALUATION --> ERROR: evaluationFailed()
    EVALUATION --> CREATIVE: retryCreation()

    COMPLETED --> IDLE: reset()
    COMPLETED --> [*]: System shutdown

    ERROR --> IDLE: reset()
    ERROR --> DECONSTRUCTION: retryFromStart()
    ERROR --> [*]: System shutdown

    note right of DECONSTRUCTION
        Genealogist analyzes
        and deconstructs values
    end note

    note right of NIHILISTIC
        Dionysus creates void
        LastMan warns of passivity
    end note

    note right of CREATIVE
        Zarathustra, Dionysus
        Apollo create new value
    end note

    note right of EVALUATION
        Zarathustra applies
        eternal return test
    end note
                    </pre>
                </div>
            </section>

            <section id="despliegue">
                <h2>üöÄ 5. Diagrama de Despliegue</h2>
                <p>El diagrama de despliegue muestra la arquitectura de despliegue del sistema, incluyendo servicios Docker, contenedores y redes.</p>

                <div class="diagram-container">
                    <pre class="mermaid">
graph TB
    subgraph Client_Layer["Client Layer"]
        Browser[Web Browser]
        API_Client[API Clients]
    end

    subgraph Application_Server["Application Server"]
        API_Container[Fastify API Container]
        Worker_Container[BullMQ Workers Container]
    end

    subgraph Database_Services["Database Services"]
        PostgreSQL_Container[(PostgreSQL 15 + pgvector)]
        Neo4j_Container[(Neo4j 5.x)]
        Redis_Container[(Redis 7.x)]
    end

    subgraph LLM_Service["LLM Service"]
        LMStudio_Container[LM Studio Local LLM]
    end

    subgraph Monitoring_Stack["Monitoring Stack"]
        Prometheus_Container[Prometheus]
        Grafana_Container[Grafana]
    end

    Browser --> API_Container
    API_Client --> API_Container

    API_Container --> PostgreSQL_Container
    API_Container --> Neo4j_Container
    API_Container --> Redis_Container
    API_Container --> LMStudio_Container
    API_Container --> Prometheus_Container

    Worker_Container --> PostgreSQL_Container
    Worker_Container --> Neo4j_Container
    Worker_Container --> Redis_Container
    Worker_Container --> LMStudio_Container

    Prometheus_Container --> API_Container
    Prometheus_Container --> Worker_Container
    Grafana_Container --> Prometheus_Container
                    </pre>
                </div>
            </section>
        </main>

        <footer>
            <p><strong>Sistema de Generaci√≥n de Valores Nietzscheano</strong></p>
            <p>√öltima actualizaci√≥n: 2026-01-11 | Versi√≥n 1.0</p>
            <p>Proyecto: <a href="https://github.com/rflvz/nietzsche-ai" target="_blank">github.com/rflvz/nietzsche-ai</a></p>
            <p>Documentaci√≥n completa: <a href="./uml-diagrams.md">uml-diagrams.md</a></p>
        </footer>
    </div>

    <script>
        // Inicializar Mermaid con manejo de errores
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                showSequenceNumbers: false
            },
            class: {
                useMaxWidth: true
            },
            logLevel: 'debug'
        });

        // Renderizar diagramas con manejo de errores
        window.addEventListener('load', function() {
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        });

        // Smooth scroll para los enlaces de navegaci√≥n
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Manejo de errores de Mermaid
        window.addEventListener('error', function(e) {
            console.error('Error rendering diagram:', e);
        });
    </script>
</body>
</html>
